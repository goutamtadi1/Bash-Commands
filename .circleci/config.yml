---
version: 2.1
orbs:
  gh: circleci/github-cli@1.0.3

jobs:
  create-pr:
    docker:
      - image: 'cimg/base:stable'
    steps:
      - add_ssh_keys:
          fingerprints:
            - 24:f0:91:e0:f6:03:3a:04:3a:b7:95:1e:00:e5:e2:61
            - c0:62:36:77:1a:4b:e9:5e:bf:c1:aa:2b:1a:43:fb:5a
      - gh/setup
      - gh/clone
      - run:
          command: |
            git checkout -b stage-release
            git config --global user.email "gtadi@astronomer.io"
            git config --global user.name "Goutam Tadi"
            cat\<<EOF>release.txt 
            Stage release
            EOF
            git add release.txt
            git commit -m 'new release'
            git push -u origin HEAD
            gh pr create --title "New Stage Release" --draft --body "New Draft PR for Stage Release"
          name: Create Pull Request

workflows:
  build:
    jobs:
      - create-pr:
          context: 
            - github_repo
